#!/bin/bash

# By Daniel Gahner Rosenkrantz
# 2022
# A reconnasiance script made to create directories, and then execute several OSINT tools against a domain to find subdomains.
# After subdomains are gathered, the tool "httprobe" is used to check for live domains and screenshots of every live domain is taken with "gowitness"
# Inspiration for the script is from the Open-Source Intelligence (OSINT) Fundamentals course by TCM Security.

domain=$1
business_name=$2

info_path=$domain/"$business_name"_basic_info
screenshot_path=$domain/"$business_name"_screenshots
subdomain_path=$domain/"$business_name"_subdomains


if [ ! -d "$domain" ];then
    mkdir $domain
fi

if [ ! -d "$subdomain_path" ];then
    mkdir $subdomain_path
fi

if [ ! -d "$screenshot_path" ];then
    mkdir $screenshot_path
fi

if [ ! -d "$info_path" ];then
    mkdir $info_path
fi


echo -e "Executing WHOIS"
whois $1 > $info_path/whois.txt

echo -e "Executing subfinder"
subfinder -d $domain > $subdomain_path/foundDomains.txt

echo -e "Executing assetfinder"
assetfinder $domain | grep $domain >> $subdomain_path/foundDomains.txt

echo -e "Executing Amass"
amass enum -d $domain >> $subdomain_path/foundDomains.txt

echo -e "Executing httprobe"
cat $subdomain_path/foundDomains.txt | grep $domain | sort -u | httprobe | tee -a $subdomain_path/alive.txt

echo -e "Taking screenshots of alive hosts"
gowitness file -f $subdomain_path/alive.txt -P $screenshot_path/
